---
layout: post
title: 字符乱码问题的本质
date: 2019-12-18
categories: test
tags: Java

---

## 字符乱码问题的本质

### 什么是字符集

字符集就是规定了 某个文字对应的二进制数字 存放方式 

为什么有这么多字符集呢?

就跟显示器有那么多 不同的接口一样

### 什么是字符编码

字符集只是一个规则集合的名字 对应到现实生活中 就是 中文 英文 德文等

对于一个字符集来说要正确编码转码一个字符集需要**三个关键因素**

1. 字符库:是一个相当于所有刻度或可显示字符的数据库 字库表决定了整个字符集能够展现表示的所有字符的范围
2. 编码字符集:即用一个编码值code point来表示一个字符在字符库中的位置
3. 字符编码:将编码字符集和实际存储数值之间的转换关系

### UTF-8和Unicode

UTF-8为变长编码

Unicode就是上面提到的编码字符集 而UTF-8就是字符编码 即Unicode规则字库的一种实现形式

Unicode的编号从0000开始一直到10FFFF共分为17个plane 每个plane中有65536个字符 而UTF-8则只实现了第一个plane 可见UTF-8虽然是一个当今接受度最广的字符集编码 但它并没有涵盖整个Unicode的字符集 这也造成了它在某些场景下对于特殊字符的处理困难

### 为什么会出现乱码

编码和解码时用了不同或不兼容的字符集

### 常见的IM乱码问题处理之Mysql中的Emoji字符

所谓Emoji就是一种在Unicode位于\u1F601-\u1F64F 区段的字符 这个显然超过了目前常用的UTF-8的编码规范

### 解决方式

1. 升级Mysql到5.6之后的版本或更高的版本 并且将字符集切换至utf8mb4
2. 再把内容存入进去之前做一次过滤 奖Emoji字符替换成一段特殊的文字编码 然后再存入数据库中 之后从数据库获取 或者前端展示的时候 再将这段特殊的文字编码转换成Emoji显示